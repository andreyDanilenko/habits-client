<template>
  <div class="min-h-screen bg-gradient-to-b from-slate-50 to-white">
    <div class="max-w-5xl mx-auto px-4 py-10 sm:px-6 lg:px-8">
      <!-- Hero -->
      <header class="text-center mb-12">
        <h1 class="text-3xl font-bold text-gray-900 tracking-tight sm:text-4xl">
          –ë–∏–ª–ª–∏–Ω–≥ –∏ –ª–∏—Ü–µ–Ω–∑–∏–∏
        </h1>
        <p class="mt-3 text-lg text-gray-600 max-w-2xl mx-auto">
          –ü–æ–∫—É–ø–∫–∞ –º–æ–¥—É–ª–µ–π –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –∞–∫–∫–∞—É–Ω—Ç—É: –æ–¥–∏–Ω —Ä–∞–∑ –∫—É–ø–∏–ª–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –≤–æ –≤—Å–µ—Ö —Å–≤–æ–∏—Ö
          –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞—Ö –∏–ª–∏ —Ç–æ–ª—å–∫–æ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∞—Ä–∏—Ñ–∞.
        </p>
      </header>

      <!-- –ú–æ–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏ (–∫—Ä–∞—Ç–∫–æ) -->
      <section v-if="licensesCount > 0" class="mb-10">
        <Card class="p-5 border border-indigo-100 bg-indigo-50/30" :shadow="true" :border="true">
          <div class="flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center gap-3">
              <div
                class="flex h-10 w-10 items-center justify-center rounded-full bg-indigo-100 text-indigo-600"
              >
                <span class="text-lg font-semibold">{{ licensesCount }}</span>
              </div>
              <div>
                <h2 class="font-semibold text-gray-900">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ª–∏—Ü–µ–Ω–∑–∏–π</h2>
                <p class="text-sm text-gray-600">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞</p>
              </div>
            </div>
            <Button variant="outline" size="sm" @click="$router.push('/workspace-settings')">
              –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
            </Button>
          </div>
        </Card>
      </section>

      <!-- –°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã -->
      <section class="mb-12">
        <h2 class="text-xl font-semibold text-gray-900 mb-1">–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã</h2>
        <p class="text-sm text-gray-500 mb-5">
          –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –º–æ–¥—É–ª—è –∏ —Ç–∞—Ä–∏—Ñ–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –æ–ø–ª–∞—Ç–∞ –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤ –Ω–∏–∂–µ.
        </p>
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
          <div
            v-for="method in paymentMethods"
            :key="method.id"
            class="group relative flex flex-col items-center rounded-xl border border-gray-200 bg-white p-6 shadow-sm transition-all hover:border-indigo-200 hover:shadow-md"
          >
            <div
              class="mb-3 flex h-12 w-12 items-center justify-center rounded-xl bg-gray-100 text-2xl transition-colors group-hover:bg-indigo-50"
            >
              {{ method.icon }}
            </div>
            <span class="font-medium text-gray-900">{{ method.name }}</span>
            <span class="mt-0.5 text-center text-xs text-gray-500">{{ method.note }}</span>
            <Button variant="outline" size="sm" disabled class="mt-4 w-full">
              {{ method.buttonLabel }}
            </Button>
          </div>
        </div>
      </section>

      <!-- –ú–æ–¥—É–ª–∏ –∏ —Ç–∞—Ä–∏—Ñ—ã -->
      <section>
        <h2 class="text-xl font-semibold text-gray-900 mb-1">–ú–æ–¥—É–ª–∏ –∏ —Ç–∞—Ä–∏—Ñ—ã</h2>
        <p class="text-sm text-gray-500 mb-8">
          –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ. –õ–∏—Ü–µ–Ω–∑–∏—è ¬´–≤—Å–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å—ã¬ª ‚Äî –æ–¥–∏–Ω —Ä–∞–∑ –∫—É–ø–∏–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –≤–µ–∑–¥–µ;
          ¬´–æ–¥–∏–Ω –≤–æ—Ä–∫—Å–ø–µ–π—Å¬ª ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ workspace.
        </p>

        <div class="space-y-8">
          <article
            v-for="item in billingModules"
            :key="item.id"
            :ref="(el) => setModuleRef(item.id, el)"
            class="overflow-hidden rounded-2xl border bg-white shadow-sm transition-all duration-300"
            :class="[
              highlightModuleId === item.id
                ? 'border-indigo-400 ring-2 ring-indigo-400/20 shadow-md'
                : 'border-gray-200 hover:border-gray-300',
            ]"
          >
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥—É–ª—è -->
            <div class="border-b border-gray-100 bg-gray-50/50 px-6 py-4">
              <div class="flex flex-wrap items-center justify-between gap-3">
                <div class="flex items-center gap-3">
                  <div
                    class="flex h-11 w-11 items-center justify-center rounded-xl text-2xl"
                    :class="item.isFree ? 'bg-green-100 text-green-700' : 'bg-indigo-100 text-indigo-600'"
                  >
                    {{ item.emoji }}
                  </div>
                  <div>
                    <h3 class="font-semibold text-gray-900">{{ item.label }}</h3>
                    <p class="text-sm text-gray-500">{{ item.description }}</p>
                  </div>
                </div>
                <Badge v-if="item.isFree" variant="green">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</Badge>
              </div>
            </div>

            <!-- –ü–ª–∞–Ω—ã -->
            <div class="p-6">
              <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
                <div
                  v-for="plan in item.plans"
                  :key="plan.id"
                  class="relative flex flex-col rounded-xl border p-5 transition-colors"
                  :class="
                    plan.popular
                      ? 'border-indigo-200 bg-indigo-50/30'
                      : 'border-gray-200 bg-white hover:bg-gray-50/50'
                  "
                >
                  <Badge
                    v-if="plan.popular"
                    variant="indigo"
                    class="absolute -top-2.5 right-3"
                  >
                    –ü–æ–ø—É–ª—è—Ä–Ω—ã–π
                  </Badge>
                  <span class="text-sm font-medium text-gray-700">{{ plan.name }}</span>
                  <span
                    class="mt-2 text-2xl font-bold tracking-tight"
                    :class="plan.isFree ? 'text-green-600' : 'text-indigo-600'"
                  >
                    {{ plan.price }}
                  </span>
                  <span class="mt-0.5 text-xs text-gray-500">{{ plan.note }}</span>
                  <Button
                    variant="outline"
                    size="sm"
                    :class="plan.popular ? 'border-indigo-300 text-indigo-700 hover:bg-indigo-50' : ''"
                    disabled
                    class="mt-4 w-full"
                  >
                    {{ plan.isFree ? '–£–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω' : '–í—ã–±—Ä–∞—Ç—å (–∑–∞–≥–ª—É—à–∫–∞)' }}
                  </Button>
                </div>
              </div>
            </div>
          </article>
        </div>
      </section>

      <!-- –°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º -->
      <section class="mt-12">
        <Card
          class="overflow-hidden border-2 border-amber-200 bg-gradient-to-br from-amber-50 to-orange-50/50 p-6"
          :shadow="true"
          :border="true"
        >
          <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div class="flex items-start gap-4">
              <div
                class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-amber-100 text-2xl"
              >
                üì¨
              </div>
              <div>
                <h2 class="font-semibold text-gray-900">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è</h2>
                <p class="mt-1 text-sm text-gray-700">
                  –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è, –æ—Å–æ–±—ã–µ —Ç–∞—Ä–∏—Ñ—ã –∏–ª–∏ –æ–ø–ª–∞—Ç–∞ –ø–æ —Å—á—ë—Ç—É ‚Äî —Å–≤—è–∂–∏—Ç–µ—Å—å —Å
                  –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ—Å–ª–µ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø –∫ –º–æ–¥—É–ª—é –±—É–¥–µ—Ç –≤—ã–¥–∞–Ω –≤—Ä—É—á–Ω—É—é
                  (–∞–¥–º–∏–Ω).
                </p>
              </div>
            </div>
            <Button variant="secondary" disabled class="flex-shrink-0">
              –°–≤—è–∑–∞—Ç—å—Å—è —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º (–∑–∞–≥–ª—É—à–∫–∞)
            </Button>
          </div>
        </Card>
      </section>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, nextTick, watch, computed } from 'vue'
import { useRoute } from 'vue-router'
import { Card, Button, Badge } from '@/shared/ui'
import { useWorkspaceStore } from '@/entities/workspace'

const route = useRoute()
const workspaceStore = useWorkspaceStore()
const highlightModuleId = ref<string | null>(null)
const moduleRefs = ref<Record<string, HTMLElement | null>>({})

const licensesCount = computed(() => workspaceStore.licenses?.length ?? 0)

function setModuleRef(id: string, el: unknown) {
  moduleRefs.value[id] = el as HTMLElement | null
}

function scrollToModule(moduleCode: string) {
  const el = moduleRefs.value[moduleCode]
  if (el) {
    el.scrollIntoView({ behavior: 'smooth', block: 'center' })
    highlightModuleId.value = moduleCode
    setTimeout(() => {
      highlightModuleId.value = null
    }, 2500)
  }
}

onMounted(() => {
  workspaceStore.loadLicenses?.()
  const module = route.query.module
  const code = Array.isArray(module) ? module[0] : module
  if (code) {
    nextTick(() => scrollToModule(code))
  }
})

watch(
  () => route.query.module,
  (module) => {
    const code = Array.isArray(module) ? module[0] : module
    if (code) nextTick(() => scrollToModule(code))
  },
)

const paymentMethods = [
  {
    id: 'card',
    name: '–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞',
    note: 'Visa, Mastercard, –ú–ò–†',
    icon: 'üí≥',
    buttonLabel: '–û–ø–ª–∞—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ–π',
  },
  {
    id: 'sbp',
    name: '–°–ë–ü',
    note: '–°–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π',
    icon: 'üì±',
    buttonLabel: '–û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –°–ë–ü',
  },
  {
    id: 'qr',
    name: 'QR-–æ–ø–ª–∞—Ç–∞',
    note: '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞',
    icon: 'üì∑',
    buttonLabel: '–ü–æ–∫–∞–∑–∞—Ç—å QR',
  },
  {
    id: 'invoice',
    name: '–ü–æ —Å—á—ë—Ç—É',
    note: '–î–ª—è —é—Ä. –ª–∏—Ü',
    icon: 'üìÑ',
    buttonLabel: '–ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç',
  },
]

const billingModules = [
  {
    id: 'habits',
    label: '–ü—Ä–∏–≤—ã—á–∫–∏',
    description: '–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫, –∫–∞–ª–µ–Ω–¥–∞—Ä—å, –¥–Ω–µ–≤–Ω–∏–∫.',
    emoji: '‚úÖ',
    isFree: true,
    plans: [
      {
        id: 'habits-core',
        name: '–ë–∞–∑–æ–≤—ã–π',
        price: '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ',
        note: 'Core-–º–æ–¥—É–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é',
        isFree: true,
        popular: false,
      },
    ],
  },
  {
    id: 'crm',
    label: 'CRM',
    description: '–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Å–¥–µ–ª–∫–∏.',
    emoji: 'üë•',
    isFree: false,
    plans: [
      {
        id: 'crm-sub-month',
        name: '–ü–æ–¥–ø–∏—Å–∫–∞, –º–µ—Å—è—Ü',
        price: '299 ‚ÇΩ/–º–µ—Å',
        note: '–î–ª—è –≤—Å–µ—Ö –≤–∞—à–∏—Ö –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤',
        isFree: false,
        popular: true,
      },
      {
        id: 'crm-sub-year',
        name: '–ü–æ–¥–ø–∏—Å–∫–∞, –≥–æ–¥',
        price: '2 990 ‚ÇΩ/–≥–æ–¥',
        note: '–≠–∫–æ–Ω–æ–º–∏—è 2 –º–µ—Å—è—Ü–∞',
        isFree: false,
        popular: false,
      },
      {
        id: 'crm-perpetual-all',
        name: '–í–µ—á–Ω–∞—è, –≤—Å–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å—ã',
        price: '9 990 ‚ÇΩ',
        note: '–û–¥–∏–Ω —Ä–∞–∑, –≤–µ–∑–¥–µ',
        isFree: false,
        popular: false,
      },
      {
        id: 'crm-perpetual-one',
        name: '–í–µ—á–Ω–∞—è, –æ–¥–∏–Ω –≤–æ—Ä–∫—Å–ø–µ–π—Å',
        price: '4 990 ‚ÇΩ',
        note: '–¢–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–π workspace',
        isFree: false,
        popular: false,
      },
    ],
  },
  {
    id: 'notes',
    label: '–ó–∞–º–µ—Ç–∫–∏',
    description: '–ü—Ä–æ—Å—Ç—ã–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ –≤–æ—Ä–∫—Å–ø–µ–π—Å—É.',
    emoji: 'üìù',
    isFree: false,
    plans: [
      {
        id: 'notes-sub-month',
        name: '–ü–æ–¥–ø–∏—Å–∫–∞, –º–µ—Å—è—Ü',
        price: '99 ‚ÇΩ/–º–µ—Å',
        note: '–î–ª—è –≤—Å–µ—Ö –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤',
        isFree: false,
        popular: true,
      },
      {
        id: 'notes-perpetual-all',
        name: '–í–µ—á–Ω–∞—è, –≤—Å–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å—ã',
        price: '1 990 ‚ÇΩ',
        note: '–û–¥–∏–Ω —Ä–∞–∑, –≤–µ–∑–¥–µ',
        isFree: false,
        popular: false,
      },
    ],
  },
  {
    id: 'inventory',
    label: '–°–∫–ª–∞–¥',
    description: '–£—á—ë—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).',
    emoji: 'üì¶',
    isFree: false,
    plans: [
      {
        id: 'inventory-sub-month',
        name: '–ü–æ–¥–ø–∏—Å–∫–∞, –º–µ—Å—è—Ü',
        price: '499 ‚ÇΩ/–º–µ—Å',
        note: '–î–ª—è –≤—Å–µ—Ö –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤',
        isFree: false,
        popular: true,
      },
      {
        id: 'inventory-perpetual-all',
        name: '–í–µ—á–Ω–∞—è, –≤—Å–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å—ã',
        price: '14 990 ‚ÇΩ',
        note: '–û–¥–∏–Ω —Ä–∞–∑, –≤–µ–∑–¥–µ',
        isFree: false,
        popular: false,
      },
    ],
  },
  {
    id: 'finance',
    label: '–§–∏–Ω–∞–Ω—Å—ã',
    description: '–ü—Ä–æ–≤–æ–¥–∫–∏ –∏ –æ—Ç—á—ë—Ç—ã (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).',
    emoji: 'üí∞',
    isFree: false,
    plans: [
      {
        id: 'finance-sub-month',
        name: '–ü–æ–¥–ø–∏—Å–∫–∞, –º–µ—Å—è—Ü',
        price: '599 ‚ÇΩ/–º–µ—Å',
        note: '–î–ª—è –≤—Å–µ—Ö –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤',
        isFree: false,
        popular: true,
      },
      {
        id: 'finance-perpetual-all',
        name: '–í–µ—á–Ω–∞—è, –≤—Å–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å—ã',
        price: '19 990 ‚ÇΩ',
        note: '–û–¥–∏–Ω —Ä–∞–∑, –≤–µ–∑–¥–µ',
        isFree: false,
        popular: false,
      },
    ],
  },
  {
    id: 'hr',
    label: 'HR',
    description: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ —Ä–æ–ª–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).',
    emoji: 'üëî',
    isFree: false,
    plans: [
      {
        id: 'hr-sub-month',
        name: '–ü–æ–¥–ø–∏—Å–∫–∞, –º–µ—Å—è—Ü',
        price: '399 ‚ÇΩ/–º–µ—Å',
        note: '–î–ª—è –≤—Å–µ—Ö –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤',
        isFree: false,
        popular: false,
      },
      {
        id: 'hr-perpetual-all',
        name: '–í–µ—á–Ω–∞—è, –≤—Å–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å—ã',
        price: '9 990 ‚ÇΩ',
        note: '–û–¥–∏–Ω —Ä–∞–∑, –≤–µ–∑–¥–µ',
        isFree: false,
        popular: false,
      },
    ],
  },
]
</script>
